#!/usr/bin/php

<?php

/**
 * Copyright 2018 Peter Streltsov
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License
 */

use streltcov\YandexGeocoder\GeoCoder;

system('clear');

$autoload = '../vendor/autoload.php';
require_once $autoload;

/**
 * @param string $coordinates
 */
$requestcontext = function ($coordinates) {

};

/**
 * @param string $address
 */
$request = function ($address) use ($requestcontext) {
    system('clear');
    $data = GeoCoder::search($address);

    $command = 0;
    while ($command != 7) {
        echo "Data requested" . PHP_EOL;
        echo PHP_EOL;
        echo "Results found: " . $data->found() . PHP_EOL;
        echo "Current position selected" . PHP_EOL;
        echo PHP_EOL;
        echo "1 - check exact" . PHP_EOL;
        echo "2 - select exact position" . PHP_EOL;
        echo "3 - select position by number (from 1 to number of results found)" . PHP_EOL;
        echo "7 - go back". PHP_EOL;
        echo PHP_EOL . PHP_EOL;
        echo "Select option: ";
        $command = trim(fgets(STDIN));
        switch ($command) {
            case '1':
                echo PHP_EOL;
                if ($data->hasExact()) {
                    echo "exact position";
                } else {
                    echo "Exact position has not been found" . PHP_EOL;
                }
                break;
            case '7':
                system('clear');
                return;
                break;
        }
    }

}; // end function


/**
 * main
 */
while (true) {

    echo PHP_EOL;
    echo "1 - search geo data (address)" . PHP_EOL;
    echo "2 - search geo context data (coordinates)" . PHP_EOL;
    echo "3 - exit" . PHP_EOL;
    echo "(default - 3): ";
    $answer = trim(fgets(STDIN));

    switch ($answer) {
        case '1':
            echo "Type address to request data:";
            $address = trim(fgets(STDIN));
            $request($address);
            break;
        case '2':
            echo "Type coordinates to request context data:";
            $coordinates = trim(fgets(STDIN));
            $requestcontext($coordinates);
            break;
        case '3':
            exit();
            break;
        default:
            exit();
            break;
    }

    system('clear');

}
